# Frontend - MikroTik 2FA VPN System

Полнофункциональный веб-интерфейс администратора на React 18.

## Технологии

- **React 18** - UI библиотека
- **Vite** - Сборщик и dev сервер
- **React Router** - Маршрутизация
- **React Query (@tanstack/react-query)** - Управление серверным состоянием
- **Zustand** - Управление локальным состоянием (auth)
- **Axios** - HTTP клиент
- **CSS Modules** - Стилизация

## Структура

```
frontend/
├── src/
│   ├── components/        # Переиспользуемые компоненты
│   │   ├── Layout.jsx     # Основной layout с навигацией
│   │   ├── ProtectedRoute.jsx  # Защита маршрутов
│   │   ├── Modal.jsx      # Переиспользуемый компонент модальных окон
│   │   └── Modal.css      # Стили для модальных окон
│   ├── pages/            # Страницы приложения
│   │   ├── LoginPage.jsx        # Вход в систему
│   │   ├── DashboardPage.jsx    # Дашборд со статистикой
│   │   ├── UsersPage.jsx        # Управление пользователями
│   │   ├── RegistrationRequestsPage.jsx  # Заявки на регистрацию
│   │   ├── VPNSessionsPage.jsx  # VPN сессии
│   │   ├── MikroTikPage.jsx     # Управление MikroTik
│   │   ├── StatsPage.jsx        # Статистика
│   │   ├── AuditLogsPage.jsx    # Журнал аудита
│   │   └── SettingsPage.jsx     # Настройки системы
│   ├── services/         # API сервисы
│   │   └── api.js        # Axios клиент с interceptors
│   ├── store/            # Zustand stores
│   │   └── authStore.js  # Управление авторизацией
│   ├── App.jsx           # Главный компонент
│   └── main.jsx          # Точка входа
├── package.json
├── vite.config.js
└── index.html
```

## Установка и запуск

### Разработка

```bash
cd frontend
npm install
npm run dev
```

Приложение будет доступно на http://localhost:5173

### Продакшен

```bash
cd frontend
npm install
npm run build
```

Собранные файлы будут в `dist/`. FastAPI автоматически обслуживает их, если директория `dist` существует.

## Реализованные страницы

### 1. LoginPage (`/login`)
- Авторизация администратора
- Валидация полей
- Обработка ошибок
- Сохранение токенов в localStorage

### 2. DashboardPage (`/`)
- Общая статистика системы (обновляется каждые 30 секунд)
- Карточки с ключевыми метриками
- Быстрые действия (ссылки на основные страницы)

### 3. UsersPage (`/users`)
- Таблица всех пользователей
- **Поиск** по имени или Telegram ID
- **Фильтрация** по статусу
- **Модальное окно редактирования** - изменение имени, телефона, email, статуса
- Быстрое изменение статуса (активация/деактивация)
- Пагинация
- Отображение статусов с цветовыми индикаторами

### 4. RegistrationRequestsPage (`/registration-requests`)
- Список заявок на регистрацию
- Фильтрация по статусу
- Одобрение/отклонение заявок
- Модальное окно для указания причины отклонения
- Отображение причины отклонения для отклоненных заявок
- Пагинация

### 5. VPNSessionsPage (`/vpn-sessions`)
- Список всех VPN сессий
- Фильтрация по статусу
- Отключение сессий
- Модальное окно для продления сессий с выбором количества часов
- Информация о времени создания и истечения
- Пагинация

### 6. MikroTikPage (`/mikrotik`)
- Вкладки для разных разделов:
  - **Конфигурации** - список конфигураций MikroTik, тестирование подключений
  - **Пользователи** - список пользователей MikroTik User Manager, удаление
  - **Firewall правила** - список правил, включение/отключение
- Обновление данных по кнопке

### 7. StatsPage (`/stats`)
- Общая статистика
- Статистика по пользователям
- Статистика по VPN сессиям
- Статистика по заявкам
- Карточки и таблицы с данными

### 8. AuditLogsPage (`/audit-logs`)
- Журнал всех действий в системе
- Фильтрация по действию, типу сущности
- Просмотр деталей (JSON)
- Пагинация

### 9. SettingsPage (`/settings`)
- Список всех системных настроек
- Фильтрация по категориям
- Inline редактирование значений
- Поддержка JSON значений
- Удаление настроек (только для супер-админа)
- Индикация зашифрованных значений

## Особенности реализации

### Компоненты
- **Modal** - переиспользуемый компонент модальных окон для всех действий
- **ProtectedRoute** - защита маршрутов от неавторизованного доступа
- **Layout** - основной layout с навигацией и header

### Управление состоянием
- **React Query** - для всех запросов к API, автоматическое кэширование и обновление
- **Zustand** - для состояния авторизации (token, admin info)
- **useState** - для локального состояния компонентов

### UI/UX улучшения
- **Модальные окна** - для всех действий редактирования, подтверждений
- **Фильтрация и поиск** - на всех страницах со списками
- **Валидация форм** - проверка данных перед отправкой
- **Состояния загрузки** - индикаторы для всех операций
- **Обработка ошибок** - user-friendly сообщения об ошибках

### Авторизация
- JWT токены сохраняются в localStorage
- Автоматическое обновление токенов при истечении (через interceptors)
- Защищенные маршруты через `ProtectedRoute`
- Редирект на `/login` при отсутствии авторизации

### Обработка ошибок
- Try-catch блоки для всех мутаций
- Отображение ошибок пользователю через alert
- Состояния загрузки для всех операций

### UX улучшения
- Индикаторы загрузки
- Отключение кнопок во время операций
- Пагинация везде, где необходимо
- Фильтрация на страницах со списками
- Цветовые индикаторы статусов
- Адаптивный дизайн

## Интеграция с Backend

Все страницы интегрированы с соответствующими API endpoints:
- `/api/auth/*` - авторизация
- `/api/users/*` - пользователи
- `/api/registration-requests/*` - заявки
- `/api/vpn-sessions/*` - VPN сессии
- `/api/mikrotik/*` - MikroTik
- `/api/stats/*` - статистика
- `/api/audit-logs/*` - аудит
- `/api/settings/*` - настройки

## Стилизация

Используются CSS переменные для темизации:
- `--primary-color` - основной цвет
- `--bg-color` - цвет фона
- `--card-bg` - фон карточек
- `--text-primary` - основной текст
- `--border-color` - цвет границ

Легко кастомизируется через изменение переменных в `index.css`.

## Безопасность

- Токены хранятся в localStorage
- Автоматическое обновление токенов
- Проверка авторизации на каждом запросе
- Защищенные маршруты
- CORS настроен на backend

## Производительность

- React Query кэширует запросы
- Автоматическая инвалидация кэша при мутациях
- Оптимистичные обновления UI
- Ленивая загрузка данных (запросы только при необходимости)

---

**Все страницы полностью функциональны и готовы к использованию!**

