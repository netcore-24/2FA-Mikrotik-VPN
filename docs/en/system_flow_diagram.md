# System Flow Diagrams

## Telegram: messages and display conditions

See the separate document: `telegram_messages_flow.md`.

## ðŸŽ¯ End-to-end system flow

> Note: the diagram below is kept in the original (Russian) form because it is primarily a technical ASCII flowchart. The surrounding documentation is provided in English.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ð­Ð¢ÐÐŸ 0: ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° (ÐÐ´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    MikroTik Router (WebFig/WinBox)
    â”œâ”€ User Manager â†’ Add User
    â”‚  â”œâ”€ username: vpn_user_ivan
    â”‚  â”œâ”€ password: SecurePass123
    â”‚  â””â”€ profile: default
    â”‚
    â””â”€ Firewall â†’ Add Rule (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)
       â”œâ”€ comment: vpn_user_ivan
       â”œâ”€ action: accept
       â””â”€ disabled: yes (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ð­Ð¢ÐÐŸ 1: Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Telegram Bot                Backend API              Database
         â”‚                           â”‚                       â”‚
    [/register]                      â”‚                       â”‚
         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
         â”‚                           â”‚                       â”‚
         â”‚ "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¤Ð˜Ðž"             â”‚                       â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
         â”‚                           â”‚                       â”‚
    [Ð˜Ð²Ð°Ð½ ÐŸÐµÑ‚Ñ€Ð¾Ð²]                    â”‚                       â”‚
         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
         â”‚                           â”‚                       â”‚
         â”‚                    create_registration_request    â”‚
         â”‚                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚                           â”‚                  INSERT INTO
         â”‚                           â”‚              registration_requests
         â”‚                           â”‚                  (status='pending')
         â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
         â”‚ "Ð—Ð°ÑÐ²ÐºÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð°"       â”‚                       â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Ð­Ð¢ÐÐŸ 2: ÐžÐ´Ð¾Ð±Ñ€ÐµÐ½Ð¸Ðµ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð¼                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Admin Web UI                Backend API              Database
         â”‚                           â”‚                       â”‚
    [Ð—Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð½Ð° Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸ÑŽ]         â”‚                       â”‚
         â”‚â”€â”€â”€â”€â”€â”€ GET /api/registration-requests â”€â”€â”€â”€>        â”‚
         â”‚                           â”‚â”€â”€â”€â”€â”€ SELECT * â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚                           â”‚        FROM           â”‚
         â”‚                           â”‚  registration_requestsâ”‚
         â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
         â”‚                           â”‚                       â”‚
    [ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€: Ð˜Ð²Ð°Ð½ ÐŸÐµÑ‚Ñ€Ð¾Ð²]          â”‚                       â”‚
    [Telegram: 123456789]            â”‚                       â”‚
         â”‚                           â”‚                       â”‚
    [ÐšÐ½Ð¾Ð¿ÐºÐ° "ÐžÐ´Ð¾Ð±Ñ€Ð¸Ñ‚ÑŒ"]              â”‚                       â”‚
         â”‚â”€â”€â”€ POST /api/registration-requests/{id}/approve â”€>â”‚
         â”‚                           â”‚                       â”‚
         â”‚                    approve_registration_request    â”‚
         â”‚                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚                           â”‚  1. INSERT INTO users â”‚
         â”‚                           â”‚     (status='approved')â”‚
         â”‚                           â”‚  2. UPDATE            â”‚
         â”‚                           â”‚     registration_requestsâ”‚
         â”‚                           â”‚     status='approved' â”‚
         â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
         â”‚                           â”‚                       â”‚
         â”‚                    send_telegram_notification     â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>Telegram API                  â”‚
                                      â”‚                       â”‚
                              [Ð’Ð°ÑˆÐ° Ð·Ð°ÑÐ²ÐºÐ° Ð¾Ð´Ð¾Ð±Ñ€ÐµÐ½Ð°!]        â”‚
                                 â†“ (to user)                 â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Ð­Ð¢ÐÐŸ 3: ÐŸÑ€Ð¸Ð²ÑÐ·ÐºÐ° MikroTik Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ð°                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Admin Web UI                Backend API         MikroTik Router
         â”‚                           â”‚                       â”‚
    [Ð¡Ñ‚Ñ€Ð°Ð½Ð¸Ñ†Ð° "ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ð¸"]        â”‚                       â”‚
    [Ð˜Ð²Ð°Ð½ ÐŸÐµÑ‚Ñ€Ð¾Ð²] [Ð ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ]    â”‚                       â”‚
         â”‚                           â”‚                       â”‚
    [ÐœÐ¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÐ½Ð¾]                 â”‚                       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                       â”‚
    â”‚ MikroTik Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚ #1:     â”‚     â”‚                       â”‚
    â”‚ [vpn_user_ivan]          â”‚     â”‚                       â”‚
    â”‚ MikroTik Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚ #2:     â”‚     â”‚                       â”‚
    â”‚ [                    ]   â”‚     â”‚                       â”‚
    â”‚ [Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ] [ÐžÑ‚Ð¼ÐµÐ½Ð°]     â”‚     â”‚                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                       â”‚
         â”‚                           â”‚                       â”‚
    [Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ]                      â”‚                       â”‚
         â”‚â”€â”€â”€ PUT /api/users/{id} â”€â”€>â”‚                       â”‚
         â”‚   { mikrotik_usernames:   â”‚                       â”‚
         â”‚     ["vpn_user_ivan"] }   â”‚                       â”‚
         â”‚                           â”‚                       â”‚
         â”‚              ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ  â”‚
         â”‚                           â”‚â”€â”€â”€ SSH/REST API â”€â”€â”€â”€â”€>â”‚
         â”‚                           â”‚  /user-manager user   â”‚
         â”‚                           â”‚  print detail         â”‚
         â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
         â”‚                           â”‚  [vpn_user_ivan] âœ“    â”‚
         â”‚                           â”‚                       â”‚
         â”‚              set_user_mikrotik_usernames          â”‚
         â”‚                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
         â”‚                           â”‚  INSERT INTO          â”‚
         â”‚                           â”‚  user_mikrotik_accountsâ”‚
         â”‚                           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
    [âœ“ Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¾]                    â”‚                       â”‚

... (diagram continues in the Russian version) ...
```

